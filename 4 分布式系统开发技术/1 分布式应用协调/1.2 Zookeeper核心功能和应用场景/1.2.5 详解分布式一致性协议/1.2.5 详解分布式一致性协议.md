**详解分布式一致性协议**



目标：掌握常见分布式一致性算法原理



![](理解一致性1.png)



![](理解一致性2.png)



![](产生不一致1.png)



![](产生不一致2.png)



![](产生不一致3.png)



![](应对部分操作失败.png)



# 1. 2PC

2PC：XA标准（工业标准） java实现：JTA。会记录日志，记录事务的交互过程。

协调者：事务的管理

参与者与协调者彼此阻塞等待

![](2PC.png)



![](2PC_P1_1.png)



![](2PC_P1_2.png)



![](2PC_P1_3.png)



![](2PC_P1_4.png)



![](2PC_P2_1.png)



![](2PC_P2_2.png)



![](2PC_P2_3.png)



![](2PC_消息流.png)



![](2PC_不足1.png)

![](2PC_不足2.png)



![](2PC_不足3.png)



![](2PC_不足4.png)



# 2. 3PC

少用。超时时长无法估量。没有工业级实现。与2PC一样，需要完备的日志记录。

![](3PC.png)



![](3PC_消息流.png)



# 3. 添加Leader

![](示例1.png)



![](示例2.png)



![](示例3.png)



![](改进示例1.png)



![](改进示例2.png)



![](改进示例3.png)



实际实现应用中需要规避的问题。Leader的高可用。

![](改进示例4.png)



# 4. Paxos

保证数据一致。较复杂，很少直接使用。基石。重要。

接受者一般有多个。

![](Paxos角色.png)



![](Paxos.png)



![](Paxos算法图示.png)



![](Paxos先后批准场景1.png)



![](Paxos先后批准场景2.png)



![](Paxos读流程.png)



# 5. 其他

ZAB：严格的顺序 flow 应用变更时，严格按照提案的txid

![](其他.png)

